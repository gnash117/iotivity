From f24fc223f2259f5ac382290924dffa48bde244e8 Mon Sep 17 00:00:00 2001
From: Vitalii Irkha <v.irkha@samsung.com>
Date: Fri, 6 Dec 2019 15:05:45 +0200
Subject: [PATCH] Fix potential null dereference

Dereference cred only if CBORPayloadToCred() finished successfully

Change-Id: Ia5c731b2d974a3ec0fc723020378020b87866837
Signed-off-by: Vitalii Irkha <v.irkha@samsung.com>
---
 resource/csdk/security/src/credresource.c | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/resource/csdk/security/src/credresource.c b/resource/csdk/security/src/credresource.c
index ab4b094f3..6f594e886 100644
--- a/resource/csdk/security/src/credresource.c
+++ b/resource/csdk/security/src/credresource.c
@@ -2478,15 +2478,15 @@ static OCEntityHandlerResult HandlePostRequest(OCEntityHandlerRequest* ehRequest
 
     res = CBORPayloadToCred(payload, size, &cred, &rownerId);
 
-#ifdef MULTIPLE_OWNER
-    if (IsSubOwner(cred->eownerID) && !IsNilUuid(cred->eownerID))
+    if (OC_STACK_OK == res)
     {
-        memcpy(rownerId, cred->eownerID, sizeof(OicUuid_t));
-    }
+#ifdef MULTIPLE_OWNER
+        if (IsSubOwner(cred->eownerID) && !IsNilUuid(cred->eownerID))
+        {
+            memcpy(rownerId, cred->eownerID, sizeof(OicUuid_t));
+        }
 #endif // MULTIPLE_OWNER
 
-    if (OC_STACK_OK == res)
-    {
         OicSecCred_t *newCred = NULL;
         OicSecCred_t *newCredTemp = NULL;
 
-- 
2.16.1.windows.1

