From b44d915248dde1dea0198aaaf1574516d7feb3d6 Mon Sep 17 00:00:00 2001
From: "v.riznyk" <v.riznyk@samsung.com>
Date: Fri, 27 Apr 2018 17:20:21 +0300
Subject: [PATCH] [IOT-3032] Provision certificate credential

Has been added acl for csr resource

Change-Id: I65c461549e9d57c37ed411ec1a2d238e1e7e93ee
Signed-off-by: v.riznyk <v.riznyk@samsung.com>
---
 .../provisioning/sample/oic_svr_db_server_justworks.dat | Bin 845 -> 924 bytes
 .../sample/oic_svr_db_server_justworks.json             |   9 +++++++++
 .../security/provisioning/src/secureresourceprovider.c  |   5 +----
 3 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/resource/csdk/security/provisioning/sample/oic_svr_db_server_justworks.dat b/resource/csdk/security/provisioning/sample/oic_svr_db_server_justworks.dat
index 6ffd2575728bcf498507568196b2377d293b3190..22408e2312b07155f20a544452c8015d96a7e608 100644
GIT binary patch
delta 65
zcmX@hHiunke{y1SP9&4Xl5`-QSzKb&x>2Z`kz+|}VsdI`3fshbb&<w}DH%nnX*v4&
UnaTRasmc1u#YLMZGVWmn0300{I{*Lx

delta 32
mcmbQkewIyWe{y1SP9)>YCFwvqv$({lWus6x<K{Pv8yErAoeci~

diff --git a/resource/csdk/security/provisioning/sample/oic_svr_db_server_justworks.json b/resource/csdk/security/provisioning/sample/oic_svr_db_server_justworks.json
index 12546d8c9..e39b154c9 100644
--- a/resource/csdk/security/provisioning/sample/oic_svr_db_server_justworks.json
+++ b/resource/csdk/security/provisioning/sample/oic_svr_db_server_justworks.json
@@ -39,7 +39,16 @@
                     { "wc": "+" }
                 ],
                 "permission": 14
+            },
+            {
+                "aceid": 6,
+                "subject": { "conntype": "auth-crypt" },
+                "resources": [
+                    { "href": "/oic/sec/csr" }
+                ],
+                "permission": 14
             }
+
         ],
         "rowneruuid": "00000000-0000-0000-0000-000000000000"
     },
diff --git a/resource/csdk/security/provisioning/src/secureresourceprovider.c b/resource/csdk/security/provisioning/src/secureresourceprovider.c
index 6da75e625..9e48a0770 100644
--- a/resource/csdk/security/provisioning/src/secureresourceprovider.c
+++ b/resource/csdk/security/provisioning/src/secureresourceprovider.c
@@ -3780,17 +3780,14 @@ static OCStackApplicationResult SRPGetCSRResourceCB(void *ctx, OCDoHandle UNUSED
     GetCsrData_t *getCsrData = (GetCsrData_t*)ctx;
     OCGetCSRResultCB resultCallback = getCsrData->resultCallback;
 
-    if (clientResponse)
+    if (clientResponse && (OC_STACK_OK == clientResponse->result))
     {
-        if (OC_STACK_OK == clientResponse->result)
-        {
             uint8_t *payload = ((OCSecurityPayload*)clientResponse->payload)->securityData;
             size_t size = ((OCSecurityPayload*)clientResponse->payload)->payloadSize;
 
             OIC_LOG_BUFFER(DEBUG, TAG, payload, size);
 
             registerResultForGetCSRResourceCB(getCsrData, OC_STACK_OK, payload, size);
-        }
     }
     else
     {
-- 
2.16.1.windows.1

